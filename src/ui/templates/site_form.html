<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Site - Native Landscape Design Tool</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 20px;
        }
        .header {
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e5e5;
            margin-bottom: 30px;
        }
        .footer {
            padding-top: 20px;
            border-top: 1px solid #e5e5e5;
            margin-top: 30px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Create Site</h1>
            <p class="lead">Define the environmental characteristics of your site</p>
            <a href="/" class="btn btn-secondary">Back to Home</a>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <form id="siteForm">
                            <h3>Basic Information</h3>
                            <div class="mb-3">
                                <label for="siteName" class="form-label">Site Name</label>
                                <input type="text" class="form-control" id="siteName" required>
                            </div>
                            
                            <h3>Location</h3>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="latitude" class="form-label">Latitude</label>
                                        <input type="number" class="form-control" id="latitude" value="36.0764" step="0.0001">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="longitude" class="form-label">Longitude</label>
                                        <input type="number" class="form-control" id="longitude" value="-94.2088" step="0.0001">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="elevation" class="form-label">Elevation (meters)</label>
                                        <input type="number" class="form-control" id="elevation" value="427">
                                    </div>
                                </div>
                            </div>
                            
                            <h3>Dimensions</h3>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="width" class="form-label">Width (feet)</label>
                                        <input type="number" class="form-control" id="width" value="50" min="1" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="length" class="form-label">Length (feet)</label>
                                        <input type="number" class="form-control" id="length" value="100" min="1" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="area" class="form-label">Area (square feet)</label>
                                        <input type="number" class="form-control" id="area" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <h3>Soil Characteristics</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="soilType" class="form-label">Soil Type</label>
                                        <select class="form-select" id="soilType">
                                            <option value="clay">Clay</option>
                                            <option value="loam" selected>Loam</option>
                                            <option value="sandy">Sandy</option>
                                            <option value="silty">Silty</option>
                                            <option value="chalky">Chalky</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="soilPh" class="form-label">Soil pH</label>
                                        <input type="number" class="form-control" id="soilPh" value="6.5" min="0" max="14" step="0.1">
                                    </div>
                                </div>
                            </div>
                            
                            <h3>Sun Exposure</h3>
                            <p>Estimate the approximate square footage of each sun exposure type in your site.</p>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="fullSun" class="form-label">Full Sun (sq ft)</label>
                                        <input type="number" class="form-control sun-exposure" id="fullSun" value="0" min="0">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="partSun" class="form-label">Part Sun (sq ft)</label>
                                        <input type="number" class="form-control sun-exposure" id="partSun" value="0" min="0">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="partShade" class="form-label">Part Shade (sq ft)</label>
                                        <input type="number" class="form-control sun-exposure" id="partShade" value="0" min="0">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="fullShade" class="form-label">Full Shade (sq ft)</label>
                                        <input type="number" class="form-control sun-exposure" id="fullShade" value="0" min="0">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="progress">
                                    <div class="progress-bar bg-warning" id="sunProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="sunProgressText">0% of site area allocated</small>
                            </div>
                            
                            <h3>Water Conditions</h3>
                            <p>Estimate the approximate square footage of each water condition in your site.</p>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="dry" class="form-label">Dry (sq ft)</label>
                                        <input type="number" class="form-control water-condition" id="dry" value="0" min="0">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="medium" class="form-label">Medium (sq ft)</label>
                                        <input type="number" class="form-control water-condition" id="medium" value="0" min="0">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="wet" class="form-label">Wet (sq ft)</label>
                                        <input type="number" class="form-control water-condition" id="wet" value="0" min="0">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="progress">
                                    <div class="progress-bar bg-info" id="waterProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="waterProgressText">0% of site area allocated</small>
                            </div>
                            
                            <h3>Additional Information</h3>
                            <div class="mb-3">
                                <label for="hardiness" class="form-label">Hardiness Zone</label>
                                <select class="form-select" id="hardiness">
                                    <option value="6b">6b</option>
                                    <option value="7a" selected>7a</option>
                                    <option value="7b">7b</option>
                                    <option value="8a">8a</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="specialConditions" class="form-label">Special Conditions (optional)</label>
                                <textarea class="form-control" id="specialConditions" rows="3" placeholder="Describe any special conditions or challenges of your site"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Create Site</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4" id="resultSection" style="display: none;">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h2>Site Created</h2>
                    </div>
                    <div class="card-body">
                        <div id="resultMessage"></div>
                        <div id="visualizationContainer" class="text-center mt-3"></div>
                        <div class="mt-3">
                            <button id="generateDesignBtn" class="btn btn-success">Generate Design</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 Native Landscape Design Tool</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Calculate area when width or length changes
            const widthInput = document.getElementById('width');
            const lengthInput = document.getElementById('length');
            const areaInput = document.getElementById('area');
            
            function calculateArea() {
                const width = parseFloat(widthInput.value) || 0;
                const length = parseFloat(lengthInput.value) || 0;
                areaInput.value = width * length;
                updateProgressBars();
            }
            
            widthInput.addEventListener('input', calculateArea);
            lengthInput.addEventListener('input', calculateArea);
            calculateArea();
            
            // Update progress bars for sun exposure and water conditions
            const sunInputs = document.querySelectorAll('.sun-exposure');
            const waterInputs = document.querySelectorAll('.water-condition');
            const sunProgress = document.getElementById('sunProgress');
            const waterProgress = document.getElementById('waterProgress');
            const sunProgressText = document.getElementById('sunProgressText');
            const waterProgressText = document.getElementById('waterProgressText');
            
            function updateProgressBars() {
                const totalArea = parseFloat(areaInput.value) || 0;
                
                // Sun exposure
                let sunTotal = 0;
                sunInputs.forEach(input => {
                    sunTotal += parseFloat(input.value) || 0;
                });
                const sunPercentage = totalArea > 0 ? (sunTotal / totalArea) * 100 : 0;
                sunProgress.style.width = Math.min(100, sunPercentage) + '%';
                sunProgressText.textContent = sunPercentage.toFixed(1) + '% of site area allocated';
                
                // Water conditions
                let waterTotal = 0;
                waterInputs.forEach(input => {
                    waterTotal += parseFloat(input.value) || 0;
                });
                const waterPercentage = totalArea > 0 ? (waterTotal / totalArea) * 100 : 0;
                waterProgress.style.width = Math.min(100, waterPercentage) + '%';
                waterProgressText.textContent = waterPercentage.toFixed(1) + '% of site area allocated';
            }
            
            sunInputs.forEach(input => {
                input.addEventListener('input', updateProgressBars);
            });
            
            waterInputs.forEach(input => {
                input.addEventListener('input', updateProgressBars);
            });
            
            // Form submission
            const siteForm = document.getElementById('siteForm');
            const resultSection = document.getElementById('resultSection');
            const resultMessage = document.getElementById('resultMessage');
            const visualizationContainer = document.getElementById('visualizationContainer');
            const generateDesignBtn = document.getElementById('generateDesignBtn');
            
            siteForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Collect form data
                const siteData = {
                    name: document.getElementById('siteName').value,
                    location: {
                        latitude: parseFloat(document.getElementById('latitude').value),
                        longitude: parseFloat(document.getElementById('longitude').value),
                        elevation: parseFloat(document.getElementById('elevation').value)
                    },
                    dimensions: {
                        width: parseFloat(document.getElementById('width').value),
                        length: parseFloat(document.getElementById('length').value),
                        area: parseFloat(document.getElementById('area').value)
                    },
                    soil_type: document.getElementById('soilType').value,
                    soil_ph: parseFloat(document.getElementById('soilPh').value),
                    sun_exposure: {
                        full_sun: parseFloat(document.getElementById('fullSun').value) || 0,
                        part_sun: parseFloat(document.getElementById('partSun').value) || 0,
                        part_shade: parseFloat(document.getElementById('partShade').value) || 0,
                        full_shade: parseFloat(document.getElementById('fullShade').value) || 0
                    },
                    water_conditions: {
                        dry: parseFloat(document.getElementById('dry').value) || 0,
                        medium: parseFloat(document.getElementById('medium').value) || 0,
                        wet: parseFloat(document.getElementById('wet').value) || 0
                    },
                    hardiness_zone: document.getElementById('hardiness').value,
                    special_conditions: document.getElementById('specialConditions').value.split('\n')
                };
                
                // Send data to server
                fetch('/api/create_site', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(siteData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        resultMessage.innerHTML = `<div class="alert alert-success">
                            <h4>Success!</h4>
                            <p>${data.message}</p>
                        </div>`;
                        
                        // Display visualization
                        visualizationContainer.innerHTML = `
                            <h4>Site Conditions Visualization</h4>
                            <img src="/visualizations/${data.visualization}" class="img-fluid" alt="Site Conditions">
                        `;
                        
                        // Store site name for design generation
                        generateDesignBtn.dataset.siteName = data.site_name;
                        
                        // Show result section
                        resultSection.style.display = 'block';
                        
                        // Scroll to result section
                        resultSection.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        resultMessage.innerHTML = `<div class="alert alert-danger">
                            <h4>Error</h4>
                            <p>${data.message}</p>
                        </div>`;
                        resultSection.style.display = 'block';
                    }
                })
                .catch(error => {
                    resultMessage.innerHTML = `<div class="alert alert-danger">
                        <h4>Error</h4>
                        <p>An error occurred: ${error.message}</p>
                    </div>`;
                    resultSection.style.display = 'block';
                });
            });
            
            // Generate design button
            generateDesignBtn.addEventListener('click', function() {
                const siteName = this.dataset.siteName;
                
                if (!siteName) {
                    alert('Site name not found. Please create a site first.');
                    return;
                }
                
                // Send request to generate design
                fetch('/api/generate_design', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ site_name: siteName })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        resultMessage.innerHTML = `<div class="alert alert-success">
                            <h4>Design Generated!</h4>
                            <p>${data.message}</p>
                            <p>Native plant percentage: ${data.statistics.native_percentage.toFixed(1)}%</p>
                            <p>Biodiversity score: ${data.statistics.biodiversity_score.toFixed(1)}/100</p>
                        </div>`;
                        
                        // Display visualization
                        visualizationContainer.innerHTML = `
                            <h4>Landscape Design Visualization</h4>
                            <img src="/visualizations/${data.visualization}" class="img-fluid" alt="Landscape Design">
                        `;
                        
                        // Scroll to result section
                        resultSection.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        resultMessage.innerHTML = `<div class="alert alert-danger">
                            <h4>Error</h4>
                            <p>${data.message}</p>
                        </div>`;
                    }
                })
                .catch(error => {
                    resultMessage.innerHTML = `<div class="alert alert-danger">
                        <h4>Error</h4>
                        <p>An error occurred: ${error.message}</p>
                    </div>`;
                });
            });
        });
    </script>
</body>
</html>
